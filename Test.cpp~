#include <iostream>
// Includes all relevant components of mlpack.

#include <math.h>
#include <ctime>

#include <mlpack/core/data/load.hpp>
#include <mlpack/core/kernels/linear_kernel.hpp>
#include <mlpack/core/kernels/gaussian_kernel.hpp>


#include "bayesridge.hpp"
#include "rvmr.hpp"
#include "utils.hpp"
// Convenience.
using namespace mlpack;
using namespace rvmr;
int main()
{

  std::cout <<"\n CXX Bayesian regression"<< std::endl;
  // First, load the data.
  arma::mat X, Xtest;
  arma::rowvec y, ytest;
  data::Load("./data/corn_m5_train.csv",X,false,true);  
  data::Load("./data/corn_m5_test.csv",Xtest,false,true);  
  data::Load("./data/corn_y_train.csv",y,false,true);
  data::Load("./data/corn_y_test.csv",ytest,false,true);  

  arma::rowvec predtrain, predtest, stdtrain, stdtest;
  double rmsetrain, rmsetest;
  
  std::cout << X.n_rows << "x" << X.n_cols << std::endl;


  
  // Bayesian Ridge regression.
  std::cout << "\nBayesian Ridge regression."<< std::endl;
  auto start = std::chrono::system_clock::now();
  BayesianRidge bayesRidge(true, false);
  bayesRidge.Train(X,y);
  auto end = std::chrono::system_clock::now();
  std::chrono::duration<double> diff = end - start;
  std::cout << "time = " << diff.count() << " s\n";
  
  rmsetrain = bayesRidge.Rmse(X, y); 
  rmsetest = bayesRidge.Rmse(Xtest, ytest);

  std::cout << "rmsetrain = "<< rmsetrain << std::endl;
  std::cout << "rmsetest = "<< rmsetest << "\n"<<  std::endl;
    


  // RVM ARD regression mode.
  std::cout << "RVM, ARD regression mode "<< std::endl;
  start = std::chrono::system_clock::now();
  RVMR<kernel::LinearKernel> ARDRegression(true, false);
  ARDRegression.Train(X,y);
  end = std::chrono::system_clock::now();
  diff = end - start;
  std::cout << "time = " << diff.count() << " s\n";

  rmsetrain = ARDRegression.Rmse(X,y);
  rmsetest = ARDRegression.Rmse(Xtest,ytest);
    
  std::cout << "rmsetrain = "<< rmsetrain << std::endl;
  std::cout << "rmsetest = "<< rmsetest << "\n"<< std::endl;

  

  // RVM Linear kernel.
  std::cout << "RVM Regression Linear kernel"<< std::endl;
  start = std::chrono::system_clock::now();
  kernel::LinearKernel kernelLin;
  RVMR<kernel::LinearKernel> RVMLinear(kernelLin, true, false);
  RVMLinear.Train(X,y);
  end = std::chrono::system_clock::now();
  diff = end - start;
  std::cout << "time = " << diff.count() << " s\n";

  rmsetrain = RVMLinear.Rmse(X,y);
  rmsetest = RVMLinear.Rmse(Xtest,ytest);
    
  std::cout << "rmsetrain = "<< rmsetrain << std::endl;
  std::cout << "rmsetest = "<< rmsetest << "\n"<<  std::endl;



  // RVM Gaussian kernel.
  std::cout << "RVM Regression Gaussian kernel"<< std::endl;
  start = std::chrono::system_clock::now();
  kernel::GaussianKernel kernelGaussian;
  RVMR<kernel::GaussianKernel> RVMrbf(kernelGaussian, true, false);
  RVMrbf.Train(X,y);
  end = std::chrono::system_clock::now();
  diff = end - start;
  std::cout << "time = " << diff.count() << " s\n";

  rmsetrain = RVMrbf.Rmse(X,y);
  rmsetest = RVMrbf.Rmse(Xtest,ytest);

  std::cout << "rmsetrain = "<< rmsetrain << std::endl;
  std::cout << "rmsetest = "<< rmsetest << "\n"<< std::endl;

  std::cout << "end " << std::endl;
}
